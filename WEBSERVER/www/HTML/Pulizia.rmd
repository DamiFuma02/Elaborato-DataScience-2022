---
title: "PULIZIA"
author: "Damiano Fumagalli"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(stringr)
knitr::opts_chunk$set(echo = TRUE)
source("../../R/importData.R")
```

# INDICE

-   [AMAZON](#amazon)

-   [DISNEY](#disney)

-   [GROSS](#gross)

-   [MOVIELENS](#movielens)

-   [NETFLIX](#netflix)

-   [SEQUELS](#sequels)

-   [TMDB](#tmdb)

-   [FONTE DATI](./Presentazione.html#fonte-dei-dati)

# AMAZON

```{r}
# View(amazon)

amazon = amazon %>% select(-date_added,-description)
colnames(amazon)[7] = "Year"
head(amazon)
```

# DISNEY

```{r}
View(disney)
disney = disney %>% select(-description,-date_added)
colnames(disney)[7] = "Year"
colnames(disney)[10] = "Genres"
head(disney)
```

# GROSS

```{r}
# View(HighestGrossers)
spec(HighestGrossers)
# DATA DI RILASCIO E INFORMAZIONI SUL FILM NON NECESSARIE
HighestGrossers = HighestGrossers %>% select(-...1,-`Movie Info`,-`Release Date`)
head(HighestGrossers)
```

# MOVIELENS

-   modificare i separatori da "::" a ";"

-   Alcuni film sono scritti in notazione francese, quindi presentano una "," intermedia nel loro nome. di conseguenza il formato CSV non è valido

-   Sostituire tutti i carattteri speciali

```{r}
# rimuove l'ultimo carattere
#View(movies)

movies = separate(movies,Title,into = c("Title","Year"),sep = -5)
# rimuove gli ultimi due caratteri
movies$Title = gsub('.{2}$', '', movies$Title)

movies$Year = gsub('.{1}$', '', movies$Year)


for (i in 1:nrow(movies)){
  if (grepl(",",movies$Title[i])){
    arr = unlist(str_split(movies$Title[i],", "))
    movies$Title[i] = paste(arr[2],arr[1])
  }
}

head(movies)



```

```{r}
spec(ratings)
ratings = ratings %>% filter(!is.na(movieID) && !is.na(Rating))
head(ratings)
```

```{r}
spec(users)
users = users %>% filter(!is.na(Gender) && !is.na(Age) && !is.na(Occupation) && !is.na(Zip))
head(users)
```

# NETFLIX

```{r}
View(netflix)
spec(netflix)
netflix = netflix %>% select(-date_added,-description)
colnames(netflix)[7] = "Year"
colnames(netflix)[10] = "Genres"
head(netflix)
```

# SEQUEL

```{r}
# View(sequels)

(titleTypes = levels(factor(sequels$`Title Type`)))

# CREATED E MODIFIED NON CI INTERESSANO NELLA NOSTRA RICERCA


sequels %>% filter(!is.na(Description))
# la tabella possiede una collona Description completamente vuota, di conseguenza è possibile rimuoverla
sequels = sequels %>% select(-Description,-Created,-Modified,-`Release Date`,-Const,-URL)
colnames(sequels)

# FILM CON VOTAZIONE NON VALIDA
head( sequels %>% filter(is.na(`IMDb Rating`)))

# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% filter(!is.na(`IMDb Rating`))


# RUNTIME NON VALIDO
head(sequels %>% filter(is.na(`Runtime (mins)`)))

# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% filter(!is.na(`Runtime (mins)`))


# ANNO NON VALIDO
sequels %>% filter(is.na(Year))
# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% sequels %>% filter(!is.na(Year))


View(sequels)
```

### GENERI FILMS

```{r}
genres = vector(mode = "character")
for (i in 1:nrow(sequels)){
  genres = append(genres,  unlist(str_split(sequels$Genres[i],", ")))
}
# LISTA CON TUTTI I GENERI
(genreList = levels(factor(genres)))


```

# TMDB

```{r}
View(tmdb)
tmdb = tmdb %>% select(-original_language,-overview,-...1)
head(tmdb)
```

# AGGIORNAMENTO

I datasets sono stati riformati togliendo eventuali dati inutili alla ricerca.

```{r}
filePath = "../CLEAN_DATA/"
# AMAZON
write_csv(amazon,paste(filePath,"amazon.csv") )

# DISNEY
write_csv(disney,paste(filePath,"disney.csv") )

# HIGH GROSS
write_csv(HighestGrossers,paste(filePath,"HighestGrossers.csv") )

# MOVIELENS MOVIES
write_csv(movies,paste(filePath,"movies.csv") )
write_csv(ratings,paste(filePath,"ratings.csv") )
write_csv(users,paste(filePath,"users.csv") )

# NETFLIX
write_csv(netflix,paste(filePath,"netflix.csv") )

# SEQUELS
write_csv(sequels,paste(filePath,"sequels.csv") )

# TMDB
write_csv(tmdb,paste(filePath,"tmdb.csv") )

```
