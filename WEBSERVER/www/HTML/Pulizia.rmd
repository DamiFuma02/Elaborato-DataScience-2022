---
title: "PULIZIA"
author: "Damiano Fumagalli"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(stringr)
knitr::opts_chunk$set(echo = TRUE)
source("../../R/importData.R")
```

# INDICE

-   [AMAZON](#amazon)

-   [DISNEY](#disney)

-   [GROSS](#gross)

-   [MOVIELENS](#movielens)

-   [NETFLIX](#netflix)

-   [SEQUELS](#sequels)

-   [TMDB](#tmdb)

-   [FONTE DATI](./Presentazione.html#fonte-dei-dati)

# AMAZON {#amazon}

```{r}
# View(amazon)

amazon = amazon %>% filter(!is.na(type))

amazon = amazon %>% select(-date_added,-description)
colnames(amazon)[7] = "Year"
colnames(amazon)[10] = "Genres"

levels(factor(amazon$type))
# siccome sono due i possibili valori si possono salvare in formato booleano

amazon = amazon %>% mutate(Movie = (type=="Movie")) %>% select(-type)




head(amazon)
```

# DISNEY {#disney}

```{r}
View(disney)
disney = disney %>% select(-description,-date_added)
colnames(disney)[7] = "Year"
colnames(disney)[10] = "Genres"
head(disney)

disney = disney %>% mutate(Movie = (type == "Movie")) %>% select(-type)


```

# GROSS {#gross}

```{r}
# View(HighestGrossers)
spec(HighestGrossers)
# DATA DI RILASCIO E INFORMAZIONI SUL FILM NON NECESSARIE
HighestGrossers = HighestGrossers %>% filter(!is.na(`Movie Runtime`)) %>% select(-...1,-`Movie Info`,-`Release Date`)

# SEPARAZIONE TITLE YEAR
HighestGrossers = separate(HighestGrossers,Title,into = c("Title","Year"),sep = -5) %>% mutate(Title = gsub('.{2}$', '', Title)) %>% mutate(Year = gsub('.{1}$', '', Year))


head(HighestGrossers)
```

# MOVIELENS {#movielens}

-   modificare i separatori da "::" a ";"

-   Alcuni film sono scritti in notazione francese, quindi presentano una "," intermedia nel loro nome. di conseguenza il formato CSV non è valido

-   Sostituire tutti i carattteri speciali

```{r}
# rimuove l'ultimo carattere
#View(movies)

movies = separate(movies,Title,into = c("Title","Year"),sep = -5)
# rimuove gli ultimi due caratteri
movies$Title = gsub('.{2}$', '', movies$Title)

movies$Year = gsub('.{1}$', '', movies$Year)


for (i in 1:nrow(movies)){
  if (grepl(",",movies$Title[i])){
    arr = unlist(str_split(movies$Title[i],", "))
    movies$Title[i] = paste(arr[2],arr[1])
  }
}

head(movies)



```

```{r}
spec(ratings)
ratings = ratings %>% filter(!is.na(movieID) && !is.na(Rating))
head(ratings)
```

```{r}
spec(users)
View(users)

colnames(users)[1] = "userID"
colnames(users)[4] = "zip"
users = users %>% filter(!is.na(Gender) && !is.na(Age)  && !is.na(zip))

users = users %>% mutate(Male = (Gender == "M")) %>% select(-Gender)



head(users)

workTable = data.frame(
  workID = 0:20,
  workType = c("other","academic/educator","artist","clerical/admin","college/grad student","customer service","doctor/health care","executive/managerial","farmer","homemaker","K-12 student","lawyer","programmer","retired","sales/marketing","scientist","self-employed","technician/engineer","tradesman/craftsman","unemployed","writer")
)

ageTable = data.frame(
  ageID = levels(factor(users$Age)),
  age = c("Under 18","18-24","25-34","35-44","45-49","50-55","Over 56")
)

View(workTable)


```

# NETFLIX {#netflix}

```{r}
View(netflix)
spec(netflix)
netflix = netflix %>% select(-date_added,-description)
colnames(netflix)[7] = "Year"
colnames(netflix)[10] = "Genres"
head(netflix)
```

# SEQUEL

```{r}
# View(sequels)

(titleTypes = levels(factor(sequels$`Title Type`)))

# CREATED E MODIFIED NON CI INTERESSANO NELLA NOSTRA RICERCA


sequels %>% filter(!is.na(Description))
# la tabella possiede una collona Description completamente vuota, di conseguenza è possibile rimuoverla
sequels = sequels %>% select(-Description,-Created,-Modified,-`Release Date`,-Const,-URL)
colnames(sequels)

# FILM CON VOTAZIONE NON VALIDA
head( sequels %>% filter(is.na(`IMDb Rating`)))

# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% filter(!is.na(`IMDb Rating`))


# RUNTIME NON VALIDO
head(sequels %>% filter(is.na(`Runtime (mins)`)))

# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% filter(!is.na(`Runtime (mins)`))


# ANNO NON VALIDO
sequels %>% filter(is.na(Year))
# PER RIMUOVERE DECOMMENTARE IL SEGUENTE CODICE
# sequels = sequels %>% sequels %>% filter(!is.na(Year))


View(sequels)
```

### GENERI FILMS

```{r}
genres = vector(mode = "character")
for (i in 1:nrow(sequels)){
  genres = append(genres,  unlist(str_split(sequels$Genres[i],", ")))
}
# LISTA CON TUTTI I GENERI
(genreList = levels(factor(genres)))

(amazonRatingTypes = levels(factor(amazon$rating)))

(amazonCountries = levels(factor(amazon$country)))


```

# TMDB {#tmdb}

```{r}
View(tmdb)
tmdb = tmdb %>% select(-original_language,-overview,-...1)
head(tmdb)
```

# AGGIORNAMENTO

I datasets sono stati riformati togliendo eventuali dati inutili alla ricerca.

```{r}
filePath = "../CLEAN_DATA/"
# AMAZON
write_csv(amazon,paste(filePath,"AMAZON/","amazon.csv",sep="") )

# DISNEY
write_csv(disney,paste(filePath,"DISNEY/","disney.csv",sep="") )

# HIGH GROSS
write_csv(HighestGrossers,paste(filePath,"GROSS/","gross.csv",sep="") )

# MOVIELENS MOVIES
write_csv(movies,paste(filePath,"MOVIELENS/","movies.csv",sep="") )
write_csv(ratings,paste(filePath,"MOVIELENS/","ratings.csv",sep="") )
write_csv(users,paste(filePath,"MOVIELENS/","users.csv",sep="") )
write_csv(workTable,paste(filePath,"MOVIELENS/","workTable.csv",sep="") )
write_csv(ageTable,paste(filePath,"MOVIELENS/","ageTable.csv",sep="") )

# NETFLIX
write_csv(netflix,paste(filePath,"NETFLIX/","netflix.csv",sep="") )

# SEQUELS
write_csv(sequels,paste(filePath,"SEQUELS/","sequels.csv",sep="") )

# TMDB
write_csv(tmdb,paste(filePath,"TMDB/","tmdb.csv",sep="") )

```
